{% extends "base.html" %}{% block content %}<h3 class="pl-4">Time series forecasting</h3><p class="pl-4">Dow Jones Industrial Average, S&P 500, and NASDAQ Composite</p><div id="time_series" class="center_flex"></div><script>    // get json data  let dji = {{dji_json | safe}};  let sp500 = {{sp500_json | safe}};  let nasdaq = {{nasdaq_json | safe}};  let dji_predict = {{dji_predict_json | safe}};  let sp500_predict = {{sp500_predict_json | safe}};  let nasdaq_predict = {{nasdaq_predict_json | safe}};  const parseDate = d3.utcParse("%Y-%m-%d");  dji_adj_price = [];  dji_show = dji.slice(dji["length"]-10)  dji_show.forEach(function(entry){      dji_adj_price.push({"date": parseDate(entry.date), "adj_price": entry.adj_close, "condition": "dji_data"})  });  sp500_adj_price = [];  sp500_show = sp500.slice(dji["length"]-10)  sp500_show.forEach(function(entry){      sp500_adj_price.push({"date": parseDate(entry.date), "adj_price": entry.adj_close, "condition": "sp500_data"})  });  nasdaq_adj_price = [];  nasdaq_show = nasdaq.slice(dji["length"]-10)  nasdaq_show.forEach(function(entry){      nasdaq_adj_price.push({"date": parseDate(entry.date), "adj_price": entry.adj_close, "condition": "nasdaq_data"})  });  Date.prototype.addDays = function(days) {    const date = new Date(this.valueOf());    date.setDate(date.getDate() + days);    return date;  }  // create the days for the predicted value  let dji_final_day = dji[dji["length"]-1].date;  let last_day = (new Date(dji_final_day)).addDays(1);  let last_day_predict_utc = new Date(last_day.getUTCFullYear(), last_day.getUTCMonth(), last_day.getUTCDate());  last_day_predict_utc.setDate(last_day_predict_utc.getUTCDate() + Object.keys(dji_predict).length+1); // +1 because inclusive  function getDates(startDate, endDate){    const dateArray = [];    let currentDate = startDate;    while (currentDate <= endDate) {        dateArray.push(new Date (currentDate));        currentDate = currentDate.addDays(1);    }    return dateArray;  }  const getDatesArray = getDates(last_day, last_day_predict_utc);  // create json of dates and predict value  dji_predict_json = [];  sp500_predict_json = [];  nasdaq_predict_json = [];    for (let i = 0; i < getDatesArray.length; i++) {        dji_predict_json.push({"date": getDatesArray[i], "adj_close": dji_predict[i][0], "condition": "dji_predicted"});        sp500_predict_json.push({            "date": getDatesArray[i],            "adj_close": sp500_predict[i][0],            "condition": "sp500_predicted"        });        nasdaq_predict_json.push({            "date": getDatesArray[i],            "adj_close": nasdaq_predict[i][0],            "condition": "nasdaq_predicted"        });    }  dji_predict_json.forEach(function(val){      dji_adj_price.push(val)  });  sp500_predict_json.forEach(function(val){      sp500_adj_price.push(val)  });  nasdaq_predict_json.forEach(function(val){      nasdaq_adj_price.push(val)  });  // show line graph  let margin = {top: 25, right:50, bottom:50, left: 50};  let width = 700  let height = 650  const svg = d3.select("#time_series").append("svg")              .attr("width", width + margin.left + margin.right)              .attr("height", height + margin.top + margin.bottom)              .style("margin-left", "auto")              .style("margin-right", "auto")              .style("display", "block")              .append("g")              .attr("transform", "translate(" + margin.left + "," + margin.top + ")");  // x-axis (date) format  let x_scale = d3.scaleTime()                .range([0, width])                .domain(d3.extent(dji_adj_price, d => d.date));  let x_axis = d3.axisBottom(x_scale)              .ticks(dji_adj_price.length)              .tickFormat(d3.timeFormat("%y-%m-%d"));  // y-axis  let y_scale = d3.scaleLinear()                .domain([0, d3.max(dji_adj_price).adj_price + 1000])                .range([height, 0]);  let y_axis = d3.axisLeft().scale(y_scale)  // add x-axis and y-axis  svg.append("g").attr("transform", "translate(0," + height + ")").call(x_axis)            .selectAll("text")            .style("text-anchor", "end")            .attr("dx", "-.8em")            .attr("dy", ".15em")            .attr("transform", function() {                return "rotate(-65)"            });  svg.append("g").call(y_axis);  // add line graph  // define the line  line = d3.line()        .curve(d3.curveStep)        .x(d => x_axis(d.date))        .y(d => y_axis(d.adj_price));  svg.append("path").datum().attr("d", line)</script><script src="https://d3js.org/d3.v5.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>{% endblock %}